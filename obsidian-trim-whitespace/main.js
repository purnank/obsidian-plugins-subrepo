var W=Object.create;var f=Object.defineProperty,O=Object.defineProperties,F=Object.getOwnPropertyDescriptor,$=Object.getOwnPropertyDescriptors,K=Object.getOwnPropertyNames,E=Object.getOwnPropertySymbols,H=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var D=(s,t,e)=>t in s?f(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,M=(s,t)=>{for(var e in t||(t={}))k.call(t,e)&&D(s,e,t[e]);if(E)for(var e of E(t))G.call(t,e)&&D(s,e,t[e]);return s},_=(s,t)=>O(s,$(t)),A=s=>f(s,"__esModule",{value:!0});var j=(s,t)=>{A(s);for(var e in t)f(s,e,{get:t[e],enumerable:!0})},z=(s,t,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of K(t))!k.call(s,i)&&i!=="default"&&f(s,i,{get:()=>t[i],enumerable:!(e=F(t,i))||e.enumerable});return s},v=s=>z(A(f(s!=null?W(H(s)):{},"default",s&&s.__esModule&&"default"in s?{get:()=>s.default,enumerable:!0}:{value:s,enumerable:!0})),s);var l=(s,t,e)=>new Promise((i,r)=>{var n=c=>{try{g(e.next(c))}catch(u){r(u)}},a=c=>{try{g(e.throw(c))}catch(u){r(u)}},g=c=>c.done?i(c.value):Promise.resolve(c.value).then(n,a);g((e=e.apply(s,t)).next())});j(exports,{default:()=>x});var m=v(require("obsidian"));var o=v(require("obsidian")),L=class extends o.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"General Settings"}),new o.Setting(t).setName("Trim on Manual Save").setDesc("Trim the document during manual save (CTRL / CMD + S).").addToggle(e=>{e.setValue(this.plugin.settings.TrimOnSave).onChange(i=>l(this,null,function*(){this.plugin.settings.TrimOnSave=i,yield this.plugin.saveSettings(),this.plugin._toggleListenerEvent(i)}))}),new o.Setting(t).setName("Auto-Trim").setDesc("Automatically trim document when modified, according to the settings below.").addToggle(e=>{e.setValue(this.plugin.settings.AutoTrimDocument).onChange(i=>l(this,null,function*(){this.plugin.settings.AutoTrimDocument=i,yield this.plugin.saveSettings(),this.plugin._toggleListenerEvent(i)}))}),new o.Setting(t).setName("Auto-Trim Delay (seconds)").setDesc("Seconds to wait before auto-trimming.").addText(e=>{e.setValue(this.plugin.settings.AutoTrimTimeout.toString()).onChange(i=>l(this,null,function*(){let r=parseFloat(i);if(isNaN(r)){new o.Notice("Trim Whitespace: Enter a valid number!");return}this.plugin.settings.AutoTrimTimeout=r,yield this.plugin.saveSettings(),this.plugin._toggleListenerEvent(!1),this.plugin._initializeDebouncer(r),this.plugin._toggleListenerEvent(!0)}))}),new o.Setting(t).setName("Preserve Code Blocks").setDesc("Whether to preserve whitespace within code blocks.").addToggle(e=>{e.setValue(this.plugin.settings.PreserveCodeBlocks).onChange(i=>l(this,null,function*(){this.plugin.settings.PreserveCodeBlocks=i,yield this.plugin.saveSettings()}))}),new o.Setting(t).setName("Convert non-breaking spaces").setDesc("Whether to convert non-breaking spaces to regular spaces.").addToggle(e=>{e.setValue(this.plugin.settings.ConvertNonBreakingSpaces).onChange(i=>l(this,null,function*(){this.plugin.settings.ConvertNonBreakingSpaces=i,yield this.plugin.saveSettings()}))}),t.createEl("h2",{text:"Trimming Rules"}),t.createEl("h3",{text:"Trailing Characters"}),new o.Setting(t).setName("Trim Trailing Spaces").setDesc("Trim spaces at the end of each line.").addToggle(e=>{e.setValue(this.plugin.settings.TrimTrailingSpaces).onChange(i=>l(this,null,function*(){this.plugin.settings.TrimTrailingSpaces=i,yield this.plugin.saveSettings()}))}),new o.Setting(t).setName("Trim Trailing Tabs").setDesc("Trim tabs at the end of each line.").addToggle(e=>{e.setValue(this.plugin.settings.TrimTrailingTabs).onChange(i=>l(this,null,function*(){this.plugin.settings.TrimTrailingTabs=i,yield this.plugin.saveSettings()}))}),new o.Setting(t).setName("Trim Trailing Lines").setDesc("Trim empty lines at the end of the document.").addToggle(e=>{e.setValue(this.plugin.settings.TrimTrailingLines).onChange(i=>l(this,null,function*(){this.plugin.settings.TrimTrailingLines=i,yield this.plugin.saveSettings(),setTimeout(()=>this.display(),100)}))}),this.plugin.settings.TrimTrailingLines&&new o.Setting(t).setName("Max lines to keep").setDesc("How many trailing lines to keep (e.g. POSIX uses 1)").addText(e=>{e.setValue(this.plugin.settings.TrailingLinesKeepMax.toString()).onChange(i=>l(this,null,function*(){let r=parseFloat(i);if(isNaN(r)){new o.Notice("Trim Whitespace: Enter a valid number!");return}this.plugin.settings.TrailingLinesKeepMax=Math.max(0,r),yield this.plugin.saveSettings()}))}),t.createEl("h3",{text:"Leading Characters"}),new o.Setting(t).setName("Preserve Indented Lists").setDesc("Preserve leading characters if they're used for list indentation.").addToggle(e=>{e.setValue(this.plugin.settings.PreserveIndentedLists).onChange(i=>l(this,null,function*(){this.plugin.settings.PreserveIndentedLists=i,yield this.plugin.saveSettings()}))}),new o.Setting(t).setName("Trim Leading Spaces").setDesc("Trim spaces at the start of each line.").addToggle(e=>{e.setValue(this.plugin.settings.TrimLeadingSpaces).onChange(i=>l(this,null,function*(){this.plugin.settings.TrimLeadingSpaces=i,yield this.plugin.saveSettings()}))}),new o.Setting(t).setName("Trim Leading Tabs").setDesc("Trim tabs at the start of each line.").addToggle(e=>{e.setValue(this.plugin.settings.TrimLeadingTabs).onChange(i=>l(this,null,function*(){this.plugin.settings.TrimLeadingTabs=i,yield this.plugin.saveSettings()}))}),new o.Setting(t).setName("Trim Leading Lines").setDesc("Trim lines at the start of the document.").addToggle(e=>{e.setValue(this.plugin.settings.TrimLeadingLines).onChange(i=>l(this,null,function*(){this.plugin.settings.TrimLeadingLines=i,yield this.plugin.saveSettings()}))}),t.createEl("h3",{text:"Multiple Characters"}),new o.Setting(t).setName("Trim Multiple Spaces").setDesc("Trim groups of multiple inline spaces.").addToggle(e=>{e.setValue(this.plugin.settings.TrimMultipleSpaces).onChange(i=>l(this,null,function*(){this.plugin.settings.TrimMultipleSpaces=i,yield this.plugin.saveSettings()}))}),new o.Setting(t).setName("Trim Multiple Tabs").setDesc("Trim groups of multiple inline tabs.").addToggle(e=>{e.setValue(this.plugin.settings.TrimMultipleTabs).onChange(i=>l(this,null,function*(){this.plugin.settings.TrimMultipleTabs=i,yield this.plugin.saveSettings()}))}),new o.Setting(t).setName("Trim Multiple Lines").setDesc("Trim groups of multiple blank lines.").addToggle(e=>{e.setValue(this.plugin.settings.TrimMultipleLines).onChange(i=>l(this,null,function*(){this.plugin.settings.TrimMultipleLines=i,yield this.plugin.saveSettings()}))})}};var R=v(require("node:os"));function y(s,t,e){let i={text:s.toString(),terms:[]};return e.forEach(r=>{let n=r.exec(i.text);if(!!n)for(;n;){let a=n[0];i.terms.push(a);let g=n.index,c=i.terms.length-1,u=`{{${t}${c.toString()}}}`;i.text=i.text.slice(0,g)+u+i.text.slice(g+a.length),r.lastIndex=0,n=r.exec(i.text)}}),i}function N(s,t,e){return e.forEach((i,r)=>{let n=`{{${t}${r.toString()}}}`,a=s.indexOf(n),g=s.substring(0,a),c=s.substring(a+n.length);s=g+i+c}),s}function X(s,t){let e=new RegExp(`(${t.join("|")})+$`,"gm");return s.replace(e,"")}function U(s,t){return s.trimEnd()+R.EOL.repeat(t.TrailingLinesKeepMax)}function q(s,t,e){let r=e?`(?!\\s*(${["\\*","\\-","\\+","\\d\\."].join("|")}))`:"",n=new RegExp(`^(${t.join("|")})+${r}`,"gm");return s.replace(n,"")}function J(s){return s.trimStart()}function Q(s){for(;;){let t=s.replace(/([^|\n \t](?:[ \t]*\t)?) {2,}(?=(?:\t[ \t]*)?[^|\n \t])/gm,"$1 ");if(t==s)return s;s=t}}function Y(s){for(;;){let t=s.replace(/([^|\n \t](?:[ \t]* )?)\t{2,}(?=(?: [ \t]*)?[^|\n \t])/gm,"$1	");if(t==s)return s;s=t}}function Z(s){return s.replace(/^\s+(?=(\n|\r|$))/gm,"")}function ee(s,t){let e=s,i=" ",r="	";if(t.ConvertNonBreakingSpaces&&(e=e.replace(/\u00a0/g," ")),t.TrimTrailingSpaces||t.TrimTrailingTabs){let n=[];t.TrimTrailingSpaces&&n.push(i),t.TrimTrailingTabs&&n.push(r),e=X(e,n)}if(t.TrimTrailingLines&&(e=U(e,t)),t.TrimLeadingSpaces||t.TrimLeadingTabs){let n=[];t.TrimLeadingSpaces&&n.push(i),t.TrimLeadingTabs&&n.push(r);let a=t.PreserveIndentedLists;e=q(e,n,a)}return t.TrimLeadingLines&&(e=J(e)),t.TrimMultipleSpaces&&(e=Q(e)),t.TrimMultipleTabs&&(e=Y(e)),t.TrimMultipleLines&&(e=Z(e)),e}function h(s,t){let e=[],i=t.PreserveCodeBlocks,r="TRIM_WHITESPACE_REPLACE_",n=[new RegExp(/(`+)([\s\S]+?)\1/gm)];if(i){let g=y(s,r,n);s=g.text,e=g.terms}let a=ee(s,_(M({},t),{TrailingLinesKeepMax:0}));return i&&(a=N(a,r,e)),a}function P(s,t,e){let i=[],r=e.exec(s);for(;r;)i.push(r),r=e.exec(s);if(i.length===0)return null;let n=i.find(a=>{let g=a.index,c=g+a[0].length;return t>=g&&t<=c});return n?{start:n.index,end:n.index+n[0].length}:null}function w(s,t,e){let i=/(?:\s?)```([\s\S]+?)```(?:\s?)/gm,r=/\s+/gm;if(e){let a=P(s,t,i);if(a)return{start:Math.max(a.start-1,0),end:a.end+1}}let n=P(s,t,r);return n?{start:n.start,end:n.end}:{start:t,end:t}}var te={TrimOnSave:!0,AutoTrimDocument:!0,AutoTrimTimeout:2.5,PreserveCodeBlocks:!0,PreserveIndentedLists:!0,ConvertNonBreakingSpaces:!1,TrimTrailingSpaces:!0,TrimLeadingSpaces:!1,TrimMultipleSpaces:!1,TrimTrailingTabs:!0,TrimLeadingTabs:!1,TrimMultipleTabs:!1,TrimTrailingLines:!0,TrimLeadingLines:!1,TrimMultipleLines:!1,TrailingLinesKeepMax:0},d;(function(i){i[i.Command=0]="Command",i[i.Save=1]="Save",i[i.AutoTrim=2]="AutoTrim"})(d||(d={}));var x=class extends m.Plugin{onload(){return l(this,null,function*(){var i,r;yield this.loadSettings(),this._initializeDebouncer(this.settings.AutoTrimTimeout),this._toggleListenerEvent(this.settings.AutoTrimDocument),this.addRibbonIcon("unindent-glyph","Trim whitespace",n=>{n.shiftKey?this.trimSelection(0):this.trimDocument(0)}),this.addCommand({id:"trim-whitespace-selection",name:"Remove whitespace in selection",editorCallback:()=>this.trimSelection(0)}),this.addCommand({id:"trim-whitespace-document",name:"Remove whitespace in document",editorCallback:()=>this.trimDocument(0)}),this.addSettingTab(new L(this.app,this));let t=(r=(i=this.app.commands)==null?void 0:i.commands)==null?void 0:r["editor:save-file"],e=t==null?void 0:t.checkCallback;typeof e=="function"&&(t.checkCallback=()=>{this.settings.TrimOnSave&&this.trimDocument(1),e()})})}_getEditor(){let t=this.app.workspace.getActiveViewOfType(m.MarkdownView);return t?t.editor:null}_initializeDebouncer(t){this.debouncedTrim=(0,m.debounce)(()=>{this._toggleListenerEvent(!1),this.trimDocument(2),this._toggleListenerEvent(!0)},t*1e3,!0)}_toggleListenerEvent(t){if(!this.debouncedTrim){new m.Notice("Trim Whitespace: Can't start auto trimmer!");return}t?this.registerEvent(this.app.workspace.on("editor-change",this.debouncedTrim,this)):this.app.workspace.off("editor-change",this.debouncedTrim)}trimSelection(t){let e=this._getEditor();if(!e)return;let i=e.getSelection();if(i.length==0){new m.Notice("Select text to trim!");return}let r=h(i,this.settings);if(r==i)return;e.replaceSelection(r);let n=e.posToOffset(e.getCursor("to")),a=r.length,g=n-a;e.setSelection(e.offsetToPos(g),e.offsetToPos(n))}trimDocument(t){let e=this._getEditor();if(!e)return;let i=e.getValue(),r=e.getCursor("from"),n=e.posToOffset(r),a=e.getCursor("to"),g=e.posToOffset(a),c,u=n,b=g;if(t==2){let S=w(i,n,this.settings.PreserveCodeBlocks),C=w(i,g,this.settings.PreserveCodeBlocks),p=i.slice(0,S.start),T=h(p,this.settings),I=i.slice(S.start,C.end),B=i.slice(C.end),V=h(B,this.settings);c=T+I+V,u=n-p.length+T.length,b=g-p.length+T.length}else{c=h(i,this.settings);let S=i.slice(0,n),C=h(S,this.settings),p=i.slice(0,g),T=h(p,this.settings);u=C.length,b=T.length}c!=i&&(e.setValue(c+`
`.repeat(this.settings.TrailingLinesKeepMax)),e.setSelection(e.offsetToPos(u),e.offsetToPos(b)))}loadSettings(){return l(this,null,function*(){this.settings=Object.assign({},te,yield this.loadData())})}saveSettings(){return l(this,null,function*(){yield this.saveData(this.settings)})}};0&&(module.exports={});

/* nosourcemap */